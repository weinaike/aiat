# AIAT (AI Assistant Toolkit)

AIæ™ºèƒ½ä½“å¼€å‘å·¥å…·åŒ… - ä¸ºAIæ™ºèƒ½ä½“æä¾›å®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼Œæ”¯æŒ **MCP (Model Context Protocol)** åè®®ã€ä»£ç åˆ†æã€æ–‡ä»¶æ“ä½œå’Œæ™ºèƒ½ä½“é€šä¿¡åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ”§ MCP åè®®æœåŠ¡å™¨
- å®Œæ•´å®ç° MCP (Model Context Protocol) è§„èŒƒ
- åŸºäº JSON-RPC 2.0 åè®®
- æ”¯æŒå·¥å…·æ³¨å†Œã€åˆ—è¡¨æŸ¥è¯¢å’Œè°ƒç”¨
- å†…ç½®è®¤è¯æœºåˆ¶ï¼ˆBearer Tokenï¼‰
- ä¸åç«¯ AgentFlow ç³»ç»Ÿæ— ç¼é›†æˆ

### ğŸ”Œ æ™ºèƒ½ä½“è¿æ¥
- WebSocket å®¢æˆ·ç«¯è¿æ¥åç«¯ AgentFlow æœåŠ¡
- å®æ—¶æ¶ˆæ¯æ¨é€å’Œæ˜¾ç¤º
- è‡ªåŠ¨å¿ƒè·³ä¿æ´»
- æ”¯æŒæ–­çº¿æç¤º

### ğŸ’¬ æ¶ˆæ¯é¢æ¿
- ç±»ä¼¼ Copilot Chat çš„æ¶ˆæ¯è§†å›¾
- æ˜¾ç¤ºæ™ºèƒ½ä½“å‘é€çš„æ¶ˆæ¯
- æ”¯æŒå‘é€æ¶ˆæ¯åˆ°æ™ºèƒ½ä½“
- æ¶ˆæ¯å†å²è®°å½•

### ğŸ“ æ–‡ä»¶æ“ä½œå·¥å…·
- `read_file` - è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆæ”¯æŒè¡ŒèŒƒå›´ï¼‰
- `write_file` - åˆ›å»ºæˆ–è¦†ç›–æ–‡ä»¶
- `list_directory` - åˆ—å‡ºç›®å½•å†…å®¹ï¼ˆæ”¯æŒé€’å½’ï¼‰
- `delete_file` - åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•

### ğŸ” ä»£ç æœç´¢å·¥å…·
- `text_search` - åœ¨å·¥ä½œåŒºä¸­æœç´¢æ–‡æœ¬ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰
- `file_search` - æŒ‰æ–‡ä»¶åæ¨¡å¼æœç´¢
- `symbol_search` - æœç´¢ä»£ç ç¬¦å·ï¼ˆå‡½æ•°ã€ç±»ç­‰ï¼‰

### ğŸ’» ç»ˆç«¯å’Œç¼–è¾‘å™¨å·¥å…·
- `run_command` - åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå‘½ä»¤
- `get_diagnostics` - è·å–è¯Šæ–­ä¿¡æ¯ï¼ˆé”™è¯¯ã€è­¦å‘Šï¼‰
- `open_file` - åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ–‡ä»¶

## å¿«é€Ÿå¼€å§‹

### 1. è°ƒè¯•è¿è¡Œæ‰©å±•

1. æ‰“å¼€é¡¹ç›®ç›®å½• `/home/wnk/code/ext`
2. æŒ‰ `F5` å¯åŠ¨æ‰©å±•è°ƒè¯•
3. åœ¨æ–°çª—å£çš„ä¾§è¾¹æ ä¼šæ˜¾ç¤º **AIAT** å›¾æ ‡ï¼ˆæœºå™¨äººå›¾æ ‡ï¼‰

### 2. é…ç½®æœåŠ¡å™¨

åœ¨ä¾§è¾¹æ  **è¿æ¥é…ç½®** é¢æ¿ä¸­æŸ¥çœ‹å’Œé…ç½®ï¼š

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| æœåŠ¡å™¨åœ°å€ | è‡ªåŠ¨æ£€æµ‹æœ¬æœº IP |
| æœåŠ¡å™¨ç«¯å£ | é»˜è®¤ 9527 |
| å›¢é˜Ÿ ID | åç«¯è¯†åˆ« ID |
| ä»£ç åº“è·¯å¾„ | å½“å‰å·¥ä½œåŒºè·¯å¾„ |
| è®¤è¯ä»¤ç‰Œ | å¯é€‰å®‰å…¨éªŒè¯ |

ç‚¹å‡» **âš™ï¸ æ‰“å¼€è®¾ç½®** ä¿®æ”¹é…ç½®ã€‚

### 3. å¯åŠ¨ MCP æœåŠ¡å™¨

- ç‚¹å‡»ä¾§è¾¹æ  **æœåŠ¡çŠ¶æ€** é¢æ¿çš„ â–¶ï¸ æŒ‰é’®
- æˆ–è¿è¡Œå‘½ä»¤ `AIAT: å¯åŠ¨å·¥å…·æœåŠ¡å™¨`

### 4. è¿æ¥æ™ºèƒ½ä½“æœåŠ¡

- åœ¨ä¾§è¾¹æ  **æ™ºèƒ½ä½“æ¶ˆæ¯** é¢æ¿ç‚¹å‡» **è¿æ¥** æŒ‰é’®
- è‡ªåŠ¨ç”Ÿæˆ UUID ä½œä¸º Run ID
- è¿æ¥æˆåŠŸåå¯æŸ¥çœ‹æ™ºèƒ½ä½“å‘é€çš„æ¶ˆæ¯

### 5. å¤åˆ¶é…ç½®åˆ°åç«¯

ç‚¹å‡» **ğŸ“‹ å¤åˆ¶ team_config** è·å–å®Œæ•´çš„åç«¯é…ç½®ã€‚

## åç«¯ AgentFlow æœåŠ¡

### æœåŠ¡åœ°å€
- **API**: `http://agent-flow.dev.csst.lab.zverse.space:32080/`
- **å¥åº·æ£€æŸ¥**: `http://agent-flow.dev.csst.lab.zverse.space:32080/health`
- **WebSocket**: `ws://agent-flow.dev.csst.lab.zverse.space:32080/ws/runs/{run_id}`

### WebSocket è¿æ¥æµç¨‹

1. æ’ä»¶å¯åŠ¨ MCP æœåŠ¡å™¨ï¼ˆç›‘å¬ 9527 ç«¯å£ï¼‰
2. æ’ä»¶è¿æ¥åç«¯ WebSocket: `ws://host/ws/runs/{run_id}`
3. å‘é€æ³¨å†Œæ¶ˆæ¯ï¼ŒåŒ…å« `team_config`
4. åç«¯æ™ºèƒ½ä½“é€šè¿‡ MCP åè®®è°ƒç”¨æœ¬åœ°å·¥å…·

### æ¶ˆæ¯æ ¼å¼

**æ³¨å†Œæ¶ˆæ¯ï¼ˆæ’ä»¶â†’åç«¯ï¼‰**:
```json
{
  "type": "register",
  "team_config": {
    "id": 1,
    "codebase": "/home/user/project/",
    "mcp_server": "192.168.1.100",
    "mcp_port": 9527
  }
}
```

**ä»»åŠ¡å¯åŠ¨æ¶ˆæ¯ï¼ˆåç«¯â†’æ’ä»¶ï¼‰**:
```json
{
  "type": "start",
  "task": "åˆ†æä»£ç åº“ç»“æ„",
  "files": [],
  "team_config": {
    "id": 2,
    "codebase": "/root/project/",
    "flow_id": "flow1",
    "node_id": ["node1"],
    "mcp_server": "10.15.49.70",
    "mcp_port": 9527
  }
}
```

### team_config å¿…éœ€å­—æ®µ

| å­—æ®µ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| id | number | âœ… | å›¢é˜Ÿé…ç½® ID |
| codebase | string | âœ… | ä»£ç åº“æ ¹è·¯å¾„ |
| mcp_server | string | âœ… | MCP æœåŠ¡å™¨ IP åœ°å€ |
| mcp_port | number | âœ… | MCP æœåŠ¡å™¨ç«¯å£ |
| mcp_token | string | âŒ | è®¤è¯ä»¤ç‰Œï¼ˆå¯é€‰ï¼‰ |
| flow_id | string | âŒ | æµç¨‹ IDï¼ˆå¯é€‰ï¼‰ |
| node_id | string[] | âŒ | èŠ‚ç‚¹ ID åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ |

## MCP åè®® API

### ç«¯ç‚¹

- `POST /` æˆ– `POST /mcp` - MCP JSON-RPC è¯·æ±‚
- `GET /status` - è·å–æœåŠ¡å™¨çŠ¶æ€
- `GET /health` - å¥åº·æ£€æŸ¥

### åˆå§‹åŒ–ä¼šè¯

```bash
curl -X POST http://localhost:9527/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 1,
    "method": "initialize",
    "params": {
      "protocolVersion": "2024-11-05",
      "capabilities": {},
      "clientInfo": {
        "name": "agent-flow",
        "version": "1.0.0"
      }
    }
  }'
```

### è·å–å·¥å…·åˆ—è¡¨

```bash
curl -X POST http://localhost:9527/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 2,
    "method": "tools/list"
  }'
```

### è°ƒç”¨å·¥å…·

```bash
curl -X POST http://localhost:9527/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": 3,
    "method": "tools/call",
    "params": {
      "name": "read_file",
      "arguments": {
        "path": "./src/extension.ts",
        "startLine": 1,
        "endLine": 50
      }
    }
  }'
```

## é…ç½®é€‰é¡¹

åœ¨ VS Code è®¾ç½®ä¸­é…ç½®ï¼ˆ`Ctrl+,` æœç´¢ `aiat`ï¼‰ï¼š

| è®¾ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `aiat.serverPort` | number | 9527 | MCP æœåŠ¡å™¨ç«¯å£ |
| `aiat.teamConfig.id` | number | 1 | å›¢é˜Ÿé…ç½® ID |
| `aiat.teamConfig.codebase` | string | "" | ä»£ç åº“è·¯å¾„ |
| `aiat.autoStart` | boolean | false | è‡ªåŠ¨å¯åŠ¨ MCP æœåŠ¡å™¨ |
| `aiat.authToken` | string | "" | è®¤è¯ä»¤ç‰Œ |
| `aiat.agentServer.url` | string | http://agent-flow... | åç«¯æ™ºèƒ½ä½“æœåŠ¡åœ°å€ |
| `aiat.agentServer.autoConnect` | boolean | false | è‡ªåŠ¨è¿æ¥æ™ºèƒ½ä½“æœåŠ¡ |
| `aiat.enableFileOperations` | boolean | true | å¯ç”¨æ–‡ä»¶æ“ä½œ |
| `aiat.enableCodeSearch` | boolean | true | å¯ç”¨ä»£ç æœç´¢ |
| `aiat.enableTerminal` | boolean | true | å¯ç”¨ç»ˆç«¯æ“ä½œ |

## å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `AIAT: å¯åŠ¨å·¥å…·æœåŠ¡å™¨` | å¯åŠ¨ MCP æœåŠ¡å™¨ |
| `AIAT: åœæ­¢å·¥å…·æœåŠ¡å™¨` | åœæ­¢ MCP æœåŠ¡å™¨ |
| `AIAT: æ˜¾ç¤ºæœåŠ¡çŠ¶æ€` | æ˜¾ç¤ºå½“å‰çŠ¶æ€ |
| `AIAT: æ‰“å¼€é…ç½®` | æ‰“å¼€è®¾ç½®é¡µé¢ |
| `AIAT: å¤åˆ¶æœåŠ¡å™¨é…ç½®ä¿¡æ¯` | å¤åˆ¶ team_config åˆ°å‰ªè´´æ¿ |
| `AIAT: è¿æ¥æ™ºèƒ½ä½“æœåŠ¡` | è¿æ¥åç«¯ WebSocket |
| `AIAT: æ–­å¼€æ™ºèƒ½ä½“æœåŠ¡` | æ–­å¼€ WebSocket è¿æ¥ |
| `AIAT: æ‰“å¼€æ¶ˆæ¯é¢æ¿` | æ‰“å¼€æ™ºèƒ½ä½“æ¶ˆæ¯è§†å›¾ |

## è°ƒè¯•æ­¥éª¤

1. **å¯åŠ¨æ‰©å±•è°ƒè¯•**
   - åœ¨ VS Code ä¸­æ‰“å¼€æœ¬é¡¹ç›®
   - æŒ‰ `F5` å¯åŠ¨æ‰©å±•å¼€å‘ä¸»æœº
   - åœ¨æ–°çª—å£ä¾§è¾¹æ æ‰¾åˆ° ğŸ¤– å›¾æ ‡

2. **å¯åŠ¨ MCP æœåŠ¡å™¨**
   - ç‚¹å‡» **æœåŠ¡çŠ¶æ€** é¢æ¿çš„ â–¶ï¸ æŒ‰é’®
   - æœåŠ¡å™¨ç›‘å¬ 9527 ç«¯å£

3. **è¿æ¥æ™ºèƒ½ä½“æœåŠ¡**
   - ç‚¹å‡» **æ™ºèƒ½ä½“æ¶ˆæ¯** é¢æ¿çš„ **è¿æ¥** æŒ‰é’®
   - è‡ªåŠ¨ç”Ÿæˆ UUID ä½œä¸º Run IDï¼ˆå¦‚ `550e8400-e29b-41d4-a716-446655440000`ï¼‰
   - è¿æ¥ `ws://agent-flow.dev.csst.lab.zverse.space:32080/ws/runs/{uuid}`

4. **æŸ¥çœ‹æ¶ˆæ¯**
   - åœ¨ **æ™ºèƒ½ä½“æ¶ˆæ¯** é¢æ¿æŸ¥çœ‹æ”¶å‘æ¶ˆæ¯
   - è“è‰²è¾¹æ¡† = æ”¶åˆ°çš„æ¶ˆæ¯
   - ç»¿è‰²è¾¹æ¡† = å‘é€çš„æ¶ˆæ¯

## å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘
npm run compile

# ç›‘å¬æ¨¡å¼
npm run watch

# è¿è¡Œæµ‹è¯•
npm test
```

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ extension.ts          # æ‰©å±•å…¥å£
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts          # MCP åè®®ç±»å‹å®šä¹‰
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ baseTool.ts       # å·¥å…·åŸºç±»
â”‚   â”œâ”€â”€ fileTools.ts      # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ searchTools.ts    # æœç´¢å·¥å…·
â”‚   â”œâ”€â”€ terminalTools.ts  # ç»ˆç«¯å·¥å…·
â”‚   â””â”€â”€ index.ts          # å·¥å…·æ³¨å†Œè¡¨
â”œâ”€â”€ server/
â”‚   â””â”€â”€ mcpServer.ts      # MCP åè®®æœåŠ¡å™¨
â”œâ”€â”€ client/
â”‚   â””â”€â”€ agentClient.ts    # WebSocket å®¢æˆ·ç«¯
â””â”€â”€ views/
    â”œâ”€â”€ statusView.ts     # çŠ¶æ€è§†å›¾
    â”œâ”€â”€ configView.ts     # é…ç½®è§†å›¾
    â””â”€â”€ chatView.ts       # èŠå¤©è§†å›¾
```

## è®¸å¯è¯

MIT
